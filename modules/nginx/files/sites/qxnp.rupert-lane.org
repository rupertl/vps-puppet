# nginx site config - managed by puppet

# Personal website qxnp.rupert-lane.org
server {
    access_log /var/log/nginx/qxnp-access.log;
    root /data/websites/prod/qxnp.rupert-lane.org;
    index index.html index.htm;

    server_name qxnp.rupert-lane.org;

    auth_basic "RESTRICTED ACCESS";
    auth_basic_user_file $document_root/.htpasswd;

    location / {
        try_files $uri $uri/ =404;
    }

    location  /awstats-icon/ {
        alias  /usr/share/awstats/icon/;
        # Not sure why I need to supply this again
        auth_basic_user_file /data/websites/prod/qxnp.rupert-lane.org/.htpasswd;
    }   

    location ~ \.pl$ {
        gzip off;
        include /etc/nginx/fastcgi_params;

        fastcgi_pass unix:/var/run/fcgiwrap.socket;
        fastcgi_index index.pl;
    }

    # This will deny access to any hidden file (beginning with a .period)
    location ~ /\. { deny  all; }

    location /transfer {
        autoindex on;
    }

}
